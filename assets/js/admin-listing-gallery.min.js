jQuery(function(e){var i=function(i,t){this.$target=i,this.$images=jQuery(".wplpro-listing-gallery__image",i),0!==this.$images.length&&(i.data("listing_gallery",this),this.flexslider_enabled=e.isFunction(e.fn.flexslider)&&wc_single_listing_params.flexslider_enabled,this.zoom_enabled=e.isFunction(e.fn.zoom)&&wc_single_listing_params.zoom_enabled,this.photoswipe_enabled="undefined"!=typeof PhotoSwipe&&wc_single_listing_params.photoswipe_enabled,t&&(this.flexslider_enabled=!1!==t.photoswipe_enabled&&this.flexslider_enabled,this.zoom_enabled=!1!==t.zoom_enabled&&this.zoom_enabled,this.photoswipe_enabled=!1!==t.photoswipe_enabled&&this.photoswipe_enabled),this.initFlexslider=this.initFlexslider.bind(this),this.initZoom=this.initZoom.bind(this),this.initPhotoswipe=this.initPhotoswipe.bind(this),this.onResetSlidePosition=this.onResetSlidePosition.bind(this),this.getGalleryItems=this.getGalleryItems.bind(this),this.openPhotoswipe=this.openPhotoswipe.bind(this),this.flexslider_enabled&&(this.initFlexslider(),i.on("wplpro_gallery_reset_slide_position",this.onResetSlidePosition)),this.zoom_enabled&&(this.initZoom(),i.on("wplpro_gallery_init_zoom",this.initZoom)),this.photoswipe_enabled&&this.initPhotoswipe())};i.prototype.initFlexslider=function(){var e=this.$images;this.$target.flexslider({selector:".wplpro-listing-gallery__wrapper > .wplpro-listing-gallery__image",animation:wc_single_listing_params.flexslider.animation,smoothHeight:wc_single_listing_params.flexslider.smoothHeight,directionNav:wc_single_listing_params.flexslider.directionNav,controlNav:wc_single_listing_params.flexslider.controlNav,slideshow:wc_single_listing_params.flexslider.slideshow,animationSpeed:wc_single_listing_params.flexslider.animationSpeed,animationLoop:wc_single_listing_params.flexslider.animationLoop,start:function(){var i=0;e.each(function(){var e=jQuery(this).height();e>i&&(i=e)}),e.each(function(){jQuery(this).css("min-height",i)})}})},i.prototype.initZoom=function(){var e=this.$images,i=this.$target.width(),t=!1;this.flexslider_enabled||(e=e.first()),jQuery(e).each(function(e,l){if(jQuery(l).find("img").attr("width")>i)return t=!0,!1}),t&&(e.trigger("zoom.destroy"),e.zoom({touch:!1}))},i.prototype.initPhotoswipe=function(){this.zoom_enabled&&this.$images.length>0&&(this.$target.prepend('<a href="#" class="wplpro-listing-gallery__trigger">üîç</a>'),this.$target.on("click",".wplpro-listing-gallery__trigger",this.openPhotoswipe)),this.$target.on("click",".wplpro-listing-gallery__image a",this.openPhotoswipe)},i.prototype.onResetSlidePosition=function(){this.$target.flexslider(0)},i.prototype.getGalleryItems=function(){var e=this.$images,i=[];return e.length>0&&e.each(function(e,t){var l=jQuery(t).find("img"),a=l.attr("data-large_image"),o=l.attr("data-large_image_width"),s=l.attr("data-large_image_height"),n={src:a,w:o,h:s,title:l.attr("title")};i.push(n)}),i},i.prototype.openPhotoswipe=function(e){e.preventDefault();var i,t=jQuery(".pswp")[0],l=this.getGalleryItems(),a=jQuery(e.target);i=a.is(".wplpro-listing-gallery__trigger")?this.$target.find(".flex-active-slide"):a.closest(".wplpro-listing-gallery__image");var o={index:jQuery(i).index(),shareEl:!1,closeOnScroll:!1,history:!1,hideAnimationDuration:0,showAnimationDuration:0};new PhotoSwipe(t,PhotoSwipeUI_Default,l,o).init()},e.fn.wc_listing_gallery=function(e){return new i(this,e),this},jQuery(".wplpro-listing-gallery").each(function(){jQuery(this).wc_listing_gallery()});var t,l;jQuery(document.body).on("click",".upload_file_button",function(e){var i=jQuery(this);if(l=i.closest("tr").find("td.file_url input"),e.preventDefault(),t)return void t.open();var a=[new wp.media.controller.Library({library:wp.media.query(),multiple:!0,title:i.data("choose"),priority:20,filterable:"uploaded"})];t=wp.media.frames.downloadable_file=wp.media({title:i.data("choose"),library:{type:""},button:{text:i.data("update")},multiple:!0,states:a}),t.on("select",function(){var e="";t.state().get("selection").map(function(i){i=i.toJSON(),i.url&&(e=i.url)}),l.val(e).change()}),t.on("ready",function(){t.uploader.options.uploader.params={type:"downloadable_listing"}}),t.open()}),jQuery(".downloadable_files tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65});var a,o=jQuery("#listing_image_gallery"),s=jQuery("#listing_images_container").find("ul.listing_images");jQuery(".add_listing_images").on("click","a",function(e){var i=jQuery(this);if(e.preventDefault(),a)return void a.open();a=wp.media.frames.listing_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0})]}),a.on("select",function(){var e=a.state().get("selection"),t=o.val();e.map(function(e){if(e=e.toJSON(),e.id){t=t?t+","+e.id:e.id;var l=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;s.append('<li class="image" data-attachment_id="'+e.id+'"><img src="'+l+'" /><ul class="actions"><li><a href="#" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}}),o.val(t)}),a.open()}),s.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,i){i.item.css("background-color","#f6f6f6")},stop:function(e,i){i.item.removeAttr("style")},update:function(){var e="";jQuery("#listing_images_container").find("ul li.image").css("cursor","default").each(function(){e=e+jQuery(this).attr("data-attachment_id")+","}),o.val(e)}}),jQuery("#listing_images_container").on("click","a.delete",function(){jQuery(this).closest("li.image").remove();var e="";return jQuery("#listing_images_container").find("ul li.image").css("cursor","default").each(function(){e=e+jQuery(this).attr("data-attachment_id")+","}),o.val(e),jQuery("#tiptip_holder").removeAttr("style"),jQuery("#tiptip_arrow").removeAttr("style"),!1})});